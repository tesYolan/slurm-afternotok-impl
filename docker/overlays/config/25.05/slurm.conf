# slurm.conf - Multi-partition escalation testing
#
# 18 nodes across 4 partitions for memory/time escalation:
# - devel: 10 nodes @ 1GB (d1-d10)
# - day: 5 nodes @ 2GB (n1-n5)
# - week: 2 nodes @ 8GB (w1-w2)
# - pi_jetz: 1 node @ 16GB (p1)

ClusterName=escalation-test
SlurmctldHost=slurmctld
SlurmUser=slurm

AuthType=auth/munge
CryptoType=crypto/munge

# Logging
SlurmctldDebug=info
SlurmctldLogFile=/var/log/slurm/slurmctld.log
SlurmdDebug=info
SlurmdLogFile=/var/log/slurm/slurmd.log

# CRITICAL: Memory-aware scheduling
SelectType=select/cons_tres
SelectTypeParameters=CR_Core_Memory

# CRITICAL: Cgroup-based process tracking and task management
ProctrackType=proctrack/cgroup
TaskPlugin=task/cgroup

# CRITICAL: Enable job containment for cgroups to work
PrologFlags=Contain

# Job accounting - captures OOM events and memory usage
JobAcctGatherType=jobacct_gather/cgroup
JobAcctGatherFrequency=task=5
AccountingStorageType=accounting_storage/slurmdbd
AccountingStorageHost=slurmdbd

# Return nodes to service after transient failures
ReturnToService=2

# Allow nodes to register even if reported memory differs from configured
# (needed for Docker containers that may report less memory than configured)
SlurmdParameters=config_overrides

# Timeouts
SlurmctldTimeout=300
SlurmdTimeout=300
InactiveLimit=0
MinJobAge=300
KillWait=30
Waittime=0

# Scheduling
SchedulerType=sched/backfill
MaxArraySize=10001

# State
StateSaveLocation=/var/spool/slurm
SlurmdSpoolDir=/var/spool/slurm
SlurmctldPidFile=/var/run/slurm/slurmctld.pid
SlurmdPidFile=/var/run/slurm/slurmd.pid

MpiDefault=none

# ============================================================
# NODE CONFIGURATION
# 18 nodes across 4 partitions for escalation testing
# ============================================================

# devel partition: 10 nodes @ 1GB each
NodeName=d[1-10] CPUs=4 RealMemory=1024 State=UNKNOWN

# day partition: 5 nodes @ 2GB each
NodeName=n[1-5] CPUs=4 RealMemory=2048 State=UNKNOWN

# week partition: 2 nodes @ 8GB each
NodeName=w[1-2] CPUs=4 RealMemory=8192 State=UNKNOWN

# pi_jetz partition: 1 node @ 16GB
NodeName=p1 CPUs=4 RealMemory=16384 State=UNKNOWN

# ============================================================
# PARTITION CONFIGURATION
# Escalation flow: devel,day -> week -> pi_jetz
# ============================================================

PartitionName=devel Nodes=d[1-10] MaxTime=00:01:00 State=UP DefMemPerCPU=256
PartitionName=day Nodes=n[1-5] Default=YES MaxTime=00:02:00 State=UP DefMemPerCPU=512
PartitionName=week Nodes=w[1-2] MaxTime=00:04:00 State=UP DefMemPerCPU=2048
PartitionName=pi_jetz Nodes=p1 MaxTime=00:15:00 State=UP DefMemPerCPU=4096
